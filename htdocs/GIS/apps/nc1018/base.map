MAP
# Defaults 
NAME iem
STATUS ON
SIZE 640 480
FONTSET "/mesonet/data/gis/static/fonts/fonts.list"
#  Iowa, yeah!
# 3x2  
EXTENT -104.2 36 -80 50
UNITS DD
SHAPEPATH "/mesonet/data/gis/"
SYMBOLSET "/mesonet/data/gis/static/symbols/stations.sym"
IMAGECOLOR 125 125 125
IMAGETYPE PNG
TRANSPARENT off
INTERLACE off

PROJECTION
  "init=epsg:4326"
END

###-----------------------
# Web section
#-----------------------
WEB
  MINSCALE 90000
  MAXSCALE 40000000
  IMAGEPATH "/var/www/htdocs/tmp/"
  IMAGEURL "/tmp/"
  LOG "/var/www/htdocs/tmp/fancy.log"
  TEMPLATE test.html
END



LAYER
  NAME credits
  TYPE POINT
  STATUS default
  TRANSFORM FALSE
  LABELCACHE OFF
  CLASS
    NAME 'credits'
    LABEL
      COLOR 250 250 250
      BACKGROUNDCOLOR 0 0 200
      SHADOWSIZE 1 1
      SHADOWCOLOR 0 0 0
      BACKGROUNDSHADOWCOLOR 0 0 0
      BACKGROUNDSHADOWSIZE 1 1
      TYPE TRUETYPE
      SIZE 16
      FONT 'arial'
      POSITION CR
      FORCE TRUE
      PARTIALS TRUE
    END
  END
  CLASS
        NAME 'smalltxt'
        LABEL
      COLOR 250 250 250
      BACKGROUNDCOLOR 0 0 0
      SHADOWSIZE 1 1
      SHADOWCOLOR 0 0 0
      BACKGROUNDSHADOWCOLOR 0 0 0
      BACKGROUNDSHADOWSIZE 1 1
      TYPE BITMAP
          SIZE MEDIUM
      POSITION CR
      FORCE TRUE
      PARTIALS TRUE
        END
  END
END


LAYER
  NAME bar
  TYPE POLYGON
  TRANSFORM FALSE
  STATUS ON
  #TRANSPARENCY 70
  LABELCACHE FALSE
  CLASS
    COLOR 0 0 0
  END
END


LAYER
  NAME singlebox
  TYPE POLYGON
  STATUS ON
  TRANSFORM FALSE
  LABELCACHE OFF
END

 
LAYER
  NAME logo
  TYPE POINT
  STATUS default
  TRANSFORM FALSE
  TRANSPARENCY 10
  CLASS
    SYMBOL 'iem_logo'
    SIZE 40
  END
END

LAYER
  NAME counties
  STATUS DEFAULT
  TYPE LINE
  DATA /mesonet/data/gis/static/shape/4326/iem/nc1018_counties.shp
  PROJECTION
    "init=epsg:4326"
  END
  LABELCACHE OFF
  #MAXSCALE 5000000
  CLASS
#    OUTLINECOLOR 186 116 13
    COLOR 0 0 0
    SIZE 1
    SYMBOL 'circle'
#    LABEL
#      SIZE TINY
#      TYPE BITMAP
#      POSITION LC
#      COLOR 190 190 190
#      OUTLINECOLOR 0 0 0
#      PARTIALS FALSE
#      FORCE FALSE
#    END
  END
#  TRANSPARENCY 75
END

#create function get_geom(varchar) returns geometry AS 'select the_geom from counties WHERE fips = $1' LANGUAGE 'sql';


LAYER
  CONNECTIONTYPE postgis
  NAME highs
  # Connect to a remote spatial database
  CONNECTION "user=nobody dbname=nc1018 host=iemdb"
  # Get the lines from the 'geom' column of the 'roads' table
  DATA "the_geom from (select d.fips, 
    round(((1.8 * d.high::real) + 32.0)::numeric, 0) as high, 
    the_geom from weather d, counties c
    WHERE d.valid = '1978-05-19' and d.fips = c.fips) as foo 
    using unique fips using srid=4326"
  STATUS DEFAULT
  TYPE POLYGON
  LABELCACHE OFF
  PROJECTION
   "init=epsg:4326"
  END
END

LAYER
  NAME states
  STATUS DEFAULT
  TYPE LINE
  DATA /mesonet/data/gis/static/shape/4326/us/states.shp
  PROJECTION
   "init=epsg:4326"
  END
  CLASS
    SYMBOL 'circle'
    SIZE 2
#    OUTLINECOLOR 0 255 0
#    COLOR 140 144 90
    COLOR  250 250 250
  END
END

END
