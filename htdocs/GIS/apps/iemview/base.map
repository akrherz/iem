MAP
# Defaults 
NAME iem
STATUS ON
SIZE 400 400
FONTSET "/mesonet/data/gis/fonts/fonts.list"
#  Iowa, yeah!
# 3x2  
EXTENT -105 36 -86 50
UNITS DD
SHAPEPATH "/mesonet/data/gis/"
SYMBOLSET "/mesonet/data/gis/symbols/stations.sym"
IMAGECOLOR 0 0 0
IMAGETYPE PNG
TRANSPARENT off
INTERLACE off

PROJECTION
  "init=epsg:4326"
END

###-----------------------
# Web section
#-----------------------
WEB
  MINSCALE 90000
  MAXSCALE 40000000
  IMAGEPATH "/var/www/htdocs/tmp/"
  IMAGEURL "/tmp/"
  LOG "/var/www/htdocs/tmp/fancy.log"
  TEMPLATE main.html
END

LAYER
  NAME states
  STATUS DEFAULT
  TYPE LINE
  DATA /mesonet/data/gis/static/shape/4326/us/states.shp
  PROJECTION
   "init=epsg:4326"
  END
  CLASS
    SYMBOL 'circle'
    SIZE 2
#    OUTLINECOLOR 0 255 0
#    COLOR 140 144 90
    COLOR  250 250 250
  END
END

LAYER
  NAME n0r
  STATUS DEFAULT
  TYPE RASTER
  DATA /mesonet/data/gis/images/unproj/USCOMP/n0r_0.tif
  PROJECTION
   "init=epsg:4326"
  END
  OFFSITE 0 0 0
#  TRANSPARENCY 50
END

LAYER
  NAME credits
  TYPE ANNOTATION
  STATUS default
  TRANSFORM FALSE
  CLASS
    NAME 'credits'
    LABEL
      COLOR 0 0 0
      BACKGROUNDCOLOR 250 250 250
#      SHADOWSIZE 1 1
#      SHADOWCOLOR 0 0 0
#      BACKGROUNDSHADOWCOLOR 0 0 0
#      BACKGROUNDSHADOWSIZE 1 1
      TYPE TRUETYPE
      SIZE 16
      FONT 'kcci'
      POSITION CR
      FORCE TRUE
      PARTIALS TRUE
      BUFFER 2
    END
  END
END

 
LAYER
  NAME logo
  #TYPE POINT
  TYPE ANNOTATION
  STATUS default
  TRANSFORM FALSE
  TRANSPARENCY 10
  LABELCACHE OFF
  CLASS
    SYMBOL 'iem_logo'
    SIZE 40
    COLOR 0 0 0
  END
END

LAYER
  NAME counties
  STATUS ON
  TYPE POLYGON
  DATA /mesonet/data/gis/static/shape/4326/us/uscounties.shp
  PROJECTION
    "init=epsg:4326"
  END
  LABELCACHE OFF
  LABELITEM 'COUNTYNAME'
  MAXSCALE 5000000
  CLASS
    OUTLINECOLOR 186 116 13
#    COLOR 140 144 90
#    LABEL
#      SIZE TINY
#      TYPE BITMAP
#      POSITION LC
#      COLOR 190 190 190
#      OUTLINECOLOR 0 0 0
#      PARTIALS FALSE
#      FORCE FALSE
#    END
  END
#  TRANSPARENCY 75
END



LAYER
  CONNECTIONTYPE postgis
  NAME surface
  # Connect to a remote spatial database
  CONNECTION "user=nobody dbname=iem port=9999 host=10.10.10.30"
  # Get the lines from the 'geom' column of the 'roads' table
  DATA "geom from (select geom, round(tsf0::numeric,0) as tsf0,
    oid from current WHERE (valid > CURRENT_TIMESTAMP - '2 hours'::interval)
    and tsf0 > -30) as foo using unique oid using srid=4326"
  STATUS DEFAULT
  TYPE POINT
  LABELCACHE OFF
  PROJECTION
   "init=epsg:4326"
  END
  CLASSITEM "tsf0"
  CLASS
    EXPRESSION ([tsf0] >= 35)
    COLOR 30 137 20
    SYMBOL 'circle'
    SIZE 10
  END
  CLASS
    EXPRESSION ([tsf0] >= 34)
    COLOR 42 193 29
    SYMBOL 'circle'
    SIZE 10
  END
  CLASS
    EXPRESSION ([tsf0] >= 33)
    COLOR 53 224 37
    SYMBOL 'circle'
    SIZE 10
  END
  CLASS
    EXPRESSION ([tsf0] >= 32)
    COLOR 232 64 226
    SYMBOL 'circle'
    SIZE 10
  END
  CLASS
    EXPRESSION ([tsf0] >= 31)
    COLOR 232 114 226
    SYMBOL 'circle'
    SIZE 10
  END
  CLASS
    EXPRESSION ([tsf0] >= 30)
    COLOR 232 164 226
    SYMBOL 'circle'
    SIZE 10
  END
  CLASS
    EXPRESSION ([tsf0] < 30)
    COLOR 232 214 226
    SYMBOL 'circle'
    SIZE 10
  END
END

LAYER
  CONNECTIONTYPE postgis
  NAME sites
  # Connect to a remote spatial database
  CONNECTION "user=nobody dbname=iem port=9999 host=10.10.10.30"
  # Get the lines from the 'geom' column of the 'roads' table
  DATA "geom from (select geom, round(tmpf::numeric,0) as tmpf, 
    oid from current WHERE (valid > CURRENT_TIMESTAMP - '2 hours'::interval)
    ) as foo using unique oid using srid=4326"
  STATUS DEFAULT
  TYPE POINT
  LABELCACHE ON
  PROJECTION
   "init=epsg:4326"
  END
  CLASSITEM "tmpf"
  CLASS
    EXPRESSION ([tmpf] >= 35 && [tmpf] < 120)
    TEXT ([ tmpf ])
    COLOR -1 -1 -1
    LABEL
      COLOR 30 137 20
      #OUTLINECOLOR 250 250 250
      TYPE BITMAP
      SIZE MEDIUM
      POSITION UL
      OFFSET 2 2
      BUFFER 1
      PARTIALS TRUE
      FORCE FALSE
    END
  END
  CLASS
    EXPRESSION ([tmpf] >= 34)
    TEXT ([ tmpf ])
    COLOR -1 -1 -1
    LABEL
      COLOR 42 193 29
      #OUTLINECOLOR 250 250 250
      TYPE BITMAP
      SIZE MEDIUM
      POSITION UL
      OFFSET 2 2
      BUFFER 1
      PARTIALS TRUE
      FORCE FALSE
    END
  END
  CLASS
    EXPRESSION ([tmpf] >= 33)
    TEXT ([ tmpf ])
    COLOR -1 -1 -1
    LABEL
      COLOR 53 224 37
      #OUTLINECOLOR 250 250 250
      TYPE BITMAP
      SIZE MEDIUM
      POSITION UL
      OFFSET 2 2
      BUFFER 1
      PARTIALS TRUE
      FORCE FALSE
    END
  END
  CLASS
    EXPRESSION ([tmpf] >= 32)
    TEXT ([ tmpf ])
    COLOR -1 -1 -1
    LABEL
      COLOR 232 64 226
      TYPE BITMAP
      SIZE MEDIUM
      POSITION UL
      OFFSET 2 2
      BUFFER 1
      PARTIALS TRUE
      FORCE FALSE
    END
  END
  CLASS
    EXPRESSION ([tmpf] >= 31)
    TEXT ([ tmpf ])
    COLOR -1 -1 -1
    LABEL
      COLOR 232 114 226
      TYPE BITMAP
      SIZE MEDIUM
      POSITION UL
      OFFSET 2 2
      BUFFER 1
      PARTIALS TRUE
      FORCE FALSE
    END
  END
  CLASS
    EXPRESSION ([tmpf] >= 30)
    TEXT ([ tmpf ])
    COLOR -1 -1 -1
    LABEL
      COLOR 232 164 226
      TYPE BITMAP
      SIZE MEDIUM
      POSITION UL
      OFFSET 2 2
      BUFFER 1
      PARTIALS TRUE
      FORCE FALSE
    END
  END
  CLASS
    EXPRESSION ([tmpf] > -40)
    TEXT ([ tmpf ])
    COLOR -1 -1 -1
    LABEL
      COLOR 232 214 226
      TYPE BITMAP
      SIZE MEDIUM
      POSITION UL
      OFFSET 2 2
      BUFFER 1
      PARTIALS TRUE
      FORCE FALSE
    END
  END
END

END
