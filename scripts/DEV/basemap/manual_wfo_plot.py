from pyiem.plot import MapPlot, james
"""
 select substr(roomname, 1, 3) as wfo, count(*) / 91. as cnt from chatroomlog
 where ts > '2015-10-21' and sender != 'nwsbot@nwschat.weather.gov/twisted_words'
 and length(roomname) = 7 and substr(roomname, 4, 4) = 'chat'
 GROUP by wfo ORDER by cnt DESC;
"""

data = """ztl    61.9230769230769231
fwd    35.6703296703296703
zmp    33.0329670329670330
awc    30.2527472527472527
sgf    19.8681318681318681
otx    18.1318681318681319
zme    14.0769230769230769
zoa    13.0109890109890110
oun    12.8021978021978022
ewx    12.6593406593406593
box    12.0769230769230769
pqr    11.0219780219780220
ffc    10.5384615384615385
zlc    10.3516483516483516
zau    10.0329670329670330
zfw    10.0329670329670330
dmx    9.9780219780219780
lsx    9.7032967032967033
jan    9.3626373626373626
hgx    9.0219780219780220
zob    8.7582417582417582
slc    8.4505494505494505
shv    8.3846153846153846
rlx    8.1318681318681319
dvn    7.9670329670329670
oax    7.9010989010989011
lix    7.5164835164835165
tbw    6.8351648351648352
zla    6.4835164835164835
lmk    6.3406593406593407
eax    6.3406593406593407
ohx    5.9340659340659341
mkx    5.8461538461538462
meg    5.7362637362637363
ama    5.5824175824175824
mpx    5.5054945054945055
zdv    5.4615384615384615
gjt    5.2967032967032967
iwx    5.2417582417582418
mfl    5.1978021978021978
fsd    4.9670329670329670
chs    4.9120879120879121
tae    4.8571428571428571
hun    4.8461538461538462
bmx    4.6593406593406593
lwx    4.6153846153846154
tsa    4.5714285714285714
mqt    4.5494505494505495
lub    4.4725274725274725
arx    4.4615384615384615
btv    4.4395604395604396
apx    4.3736263736263736
grr    4.2967032967032967
zhu    4.2197802197802198
maf    3.8461538461538462
pdt    3.7692307692307692
iln    3.6923076923076923
ict    3.6373626373626374
gsp    3.4615384615384615
ind    3.4505494505494505
mob    3.4065934065934066
pah    3.3846153846153846
lot    3.3736263736263736
sgx    3.1868131868131868
ilx    2.9340659340659341
ddc    2.7582417582417582
fgf    2.7032967032967033
zkc    2.6923076923076923
twc    2.6813186813186813
psr    2.6593406593406593
cys    2.6263736263736264
top    2.5494505494505495
mlb    2.4835164835164835
tfx    2.3626373626373626
bou    2.3186813186813187
grb    2.3186813186813187
lox    2.2967032967032967
pub    2.2417582417582418
gyx    2.2307692307692308
phi    2.1978021978021978
ilm    2.1758241758241758
byz    2.1538461538461538
rnk    2.0439560439560440
lzk    2.0219780219780220
bis    1.8791208791208791
zse    1.8461538461538462
jax    1.7912087912087912
mfr    1.7692307692307692
zbw    1.7252747252747253
cle    1.7142857142857143
dlh    1.6043956043956044
bgm    1.5274725274725275
sjt    1.5054945054945055
gid    1.4945054945054945
ajk    1.4835164835164835
zdc    1.4505494505494505
ctp    1.4285714285714286
pbz    1.4285714285714286
boi    1.4285714285714286
gld    1.4285714285714286
epz    1.4175824175824176
hnx    1.4175824175824176
mrx    1.3296703296703297
mso    1.3186813186813187
abq    1.2967032967032967
lbf    1.2637362637362637
lch    1.2307692307692308
riw    1.2087912087912088
crp    1.1648351648351648
cae    1.1428571428571429
dtx    1.1208791208791209
buf    1.0989010989010989
sju    1.0549450549450549
fgz    1.0219780219780220
zny    1.0109890109890110
sew    1.0109890109890110
ggw    0.92307692307692307692
rah    0.90109890109890109890
car    0.86813186813186813187
afg    0.73626373626373626374
zid    0.70329670329670329670
zab    0.67032967032967032967
mhx    0.59340659340659340659
key    0.59340659340659340659
okx    0.54945054945054945055
jkl    0.54945054945054945055
vef    0.40659340659340659341
aly    0.39560439560439560440
wpc    0.36263736263736263736
afc    0.31868131868131868132
lkn    0.31868131868131868132
akq    0.26373626373626373626
abr    0.26373626373626373626
bro    0.23076923076923076923
zan    0.21978021978021978022
mtr    0.18681318681318681319
unr    0.18681318681318681319
sto    0.17582417582417582418
pih    0.15384615384615384615
eka    0.06593406593406593407
roc    0.03296703296703296703
lms    0.02197802197802197802
zjx    0.02197802197802197802
zma    0.02197802197802197802
rev    0.02197802197802197802"""
d = {}
for line in data.split("\n"):
    tokens = line.split()
    d[tokens[0].upper()] = float(tokens[1])

m = MapPlot(sector='nws', axisbg='white', nologo=True,
            subtitle='Main NWS WFO Rooms Only, NWSBot messages not included', caption='@akrherz',
            title='22 Oct 2015 - 21 Jan 2016 NWSChat Avg Number of Room Messages per Day')
m.fill_cwas(d, lblformat='%.1f', ilabel=True, cmap=james(),
            bins=[0, 0.5, 1, 1.5, 2, 3, 4, 5, 10, 15, 20, 40])
m.postprocess(filename='test.png')

